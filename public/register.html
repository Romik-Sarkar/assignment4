<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Deals - Register</title>
    <link rel="stylesheet" href="mystyle.css">
</head>
<body>
    <div class="container">

        <div id="nav-placeholder"></div>

        <div class="content-wrapper">
            <aside class="sidebar">
                <h3>Settings</h3>
                <div class="controls">
                    <label for="fontSize">Font Size:</label>
                    <select id="fontSize">
                        <option value="14">Small</option>
                        <option value="16" selected>Medium</option>
                        <option value="18">Large</option>
                        <option value="20">Extra Large</option>
                    </select>

                    <label for="bgColor">Background Color:</label>
                    <input type="color" id="bgColor" value="#ffffff">
                </div>
            </aside>

            <main id="mainContent">
                <h2>User Registration</h2>
                <p>Please fill out all required fields to create your account.</p>

                <form id="registerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name: *</label>
                            <input type="text" id="firstName" name="firstName" required>
                            <span class="error" id="firstNameError"></span>
                        </div>

                        <div class="form-group">
                            <label for="lastName">Last Name: *</label>
                            <input type="text" id="lastName" name="lastName" required>
                            <span class="error" id="lastNameError"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number: * (Format: ddd-ddd-dddd)</label>
                        <input type="tel" id="phone" name="phone" placeholder="123-456-7890" required>
                        <span class="error" id="phoneError"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">Password: * (Minimum 8 characters)</label>
                            <input type="password" id="password" name="password" required>
                            <span class="error" id="passwordError"></span>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password: *</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required>
                            <span class="error" id="confirmPasswordError"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="dob">Date of Birth: * (Format: MM/DD/YYYY)</label>
                        <input type="text" id="dob" name="dob" placeholder="MM/DD/YYYY" maxlength="10" required>
                        <span class="error" id="dobError"></span>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address: * (Must contain @ and .com)</label>
                        <input type="email" id="email" name="email" required>
                        <span class="error" id="emailError"></span>
                    </div>

                    <div class="form-group">
                        <label>Gender:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="gender" value="Male"> Male</label>
                            <label><input type="radio" name="gender" value="Female"> Female</label>
                            <label><input type="radio" name="gender" value="Other"> Other</label>
                        </div>
                        <span class="error" id="genderError"></span>
                    </div>

                    <div style="margin-top: 30px;">
                        <button type="submit">Register</button>
                        <button type="reset">Reset</button>
                    </div>
                </form>

                <div class="success-message" id="successMessage">
                    <h3>âœ“ Registration Successful!</h3>
                    <p id="successDetails"></p>
                    <p><a href="/login" style="color: #155724; font-weight: bold;">Click here to login</a></p>
                </div>
            </main>
        </div>

        <footer>
            <p>&copy; 2025 Travel Deals. All rights reserved.</p>
        </footer>
    </div>

    <script src="navLoader.js"></script>
    <script>
        // Settings
        document.getElementById('fontSize').addEventListener('change', function() {
            document.getElementById('mainContent').style.fontSize = this.value + 'px';
        });

        document.getElementById('bgColor').addEventListener('change', function() {
            document.getElementById('mainContent').style.backgroundColor = this.value;
        });

        // Phone number auto-formatting (ddd-ddd-dddd)
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    e.target.value = value;
                } else if (value.length <= 6) {
                    e.target.value = value.substring(0, 3) + '-' + value.substring(3);
                } else {
                    e.target.value = value.substring(0, 3) + '-' + value.substring(3, 6) + '-' + value.substring(6, 10);
                }
            }
        });

        // Date of Birth auto-formatting (MM/DD/YYYY)
        document.getElementById('dob').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 2) {
                    e.target.value = value;
                } else if (value.length <= 4) {
                    e.target.value = value.substring(0, 2) + '/' + value.substring(2);
                } else {
                    e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4) + '/' + value.substring(4, 8);
                }
            }
        });

document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Clear previous errors
    const errors = document.querySelectorAll('.error');
    errors.forEach(error => {
        error.textContent = '';
        error.classList.remove('show');
    });

    let isValid = true;

    // Get form values
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const dob = document.getElementById('dob').value.trim();
    const email = document.getElementById('email').value.trim();
    const gender = document.querySelector('input[name="gender"]:checked');

    // Validate First Name (required)
    if (!firstName) {
        showError('firstNameError', 'First name is required');
        isValid = false;
    }

    // Validate Last Name (required)
    if (!lastName) {
        showError('lastNameError', 'Last name is required');
        isValid = false;
    }

    // Validate Phone Number (ddd-ddd-dddd format)
    if (!phone) {
        showError('phoneError', 'Phone number is required');
        isValid = false;
    } else if (!/^\d{3}-\d{3}-\d{4}$/.test(phone)) {
        showError('phoneError', 'Phone must be in format ddd-ddd-dddd');
        isValid = false;
    } else if (phone === '222-222-2222') {
        showError('phoneError', 'This phone number is reserved for system administrators');
        isValid = false;
    }

    // Validate Password (minimum 8 characters)
    if (!password) {
        showError('passwordError', 'Password is required');
        isValid = false;
    } else if (password.length < 8) {
        showError('passwordError', 'Password must be at least 8 characters');
        isValid = false;
    }

    // Validate Confirm Password (must match)
    if (!confirmPassword) {
        showError('confirmPasswordError', 'Please confirm your password');
        isValid = false;
    } else if (password !== confirmPassword) {
        showError('confirmPasswordError', 'Passwords do not match');
        isValid = false;
    }

    // Validate Date of Birth (MM/DD/YYYY format)
    if (!dob) {
        showError('dobError', 'Date of birth is required');
        isValid = false;
    } else if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dob)) {
        showError('dobError', 'Date must be in format MM/DD/YYYY');
        isValid = false;
    }

    // Validate Email (must contain @ and .com)
    if (!email) {
        showError('emailError', 'Email address is required');
        isValid = false;
    } else if (!email.includes('@') || !email.includes('.com')) {
        showError('emailError', 'Email must contain @ and .com');
        isValid = false;
    }

    // If all validations pass, register user via backend
    if (isValid) {
        try {
            const response = await fetch('http://localhost:3000/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phone: phone,
                    password: password,
                    firstName: firstName,
                    lastName: lastName,
                    dateOfBirth: dob,
                    email: email,
                    gender: gender ? gender.value : ''
                })
            });

            const result = await response.json();

            if (result.success) {
                // Also save to localStorage for backward compatibility
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(result.user);
                localStorage.setItem('users', JSON.stringify(users));

                // Show success message
                document.getElementById('successDetails').innerHTML = `
                    <strong>Name:</strong> ${firstName} ${lastName}<br>
                    <strong>Phone:</strong> ${phone}<br>
                    <strong>Email:</strong> ${email}<br>
                    <strong>Date of Birth:</strong> ${dob}<br>
                    ${gender ? `<strong>Gender:</strong> ${gender.value}<br>` : ''}
                `;
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('registerForm').style.display = 'none';
            } else {
                showError('phoneError', result.error);
            }
        } catch (error) {
            console.error('Registration error:', error);
            alert('Error registering user. Please ensure the server is running.');
        }
    }
});

function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
    errorElement.classList.add('show');
}
    </script>
</body>
</html>